<style>
  /* Screen Sichtbarkeit */
  @media screen {
    .print-only { display: none !important; }
    .screen-only { display: block !important; }
  }

  /* PRINT: nur die Gift-Card Section, Rest ausblenden */
  @media print {
    @page { size: A4; margin: 12mm; }
    :root { color-scheme: light; }
    body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }

    /* Nur diese Section drucken */
    .shopify-section { display: none !important; }
    .shopify-section--main-gift-card { display: block !important; }

    /* Header, Footer, Announcement, linke Bildspalte und Screen UI im Druck nicht zeigen */
    header, .shopify-section--header,
    footer, .shopify-section--footer,
    .announcement-bar,
    .section-split__column--image,
    .scrolling-content,
    .gift-card__screen,
    .screen-only { display: none !important; }

    /* Sea Accessibility gezielt im Druck ausblenden (exakte Selektoren) */
    #Sea-Accessibility__ButtonWidget,
    .Sea-Accessibility_WidgetIcon,
    .Sea-Accessibility_WidgetIcon.Bottom,
    .Sea-Accessibility_WidgetIcon.Bottom.Small,
    .Sea-Accessibility_WidgetIcon.Bottom.Small.StoreFront,
    .Sea-Accessibility_WidgetIcon.Bottom.Small.StoreFront.Right,
    .Sea-Accessibility_WidgetIcon.Bottom.Small.StoreFront.Right.Floating,
    [id*="Sea-Accessibility" i],
    [class*="Sea-Accessibility" i],
    [id*="sea-accessibility"],
    [class*="sea-accessibility"],
    [id*="sea-a11y" i],
    [class*="sea-a11y" i],
    iframe[src*="sea-accessibility" i] {
      display: none !important;
      visibility: hidden !important;
    }

    /* Optional: weitere g채ngige Accessibility- und Chat-Widgets im Print ausblenden */
    #userwayAccessibilityIcon, .uwy, .userway,
    #acsb-container, #acsb-bttn, .acsb-widget, .acsb-trigger,
    #hikeorders_accessibility_container, #hikeorders_a11y_button,
    .pojo-a11y-toolbar, #pojo-a11y-toolbar,
    .accessibility-widget, #accessibility-widget,
    [id*="accessibility"], [class*="accessibility"],
    [aria-label*="Accessibility"], [aria-label*="Barrierefreiheit"],
    #crisp-chatbox, .crisp-client,
    #gorgias-chat, #gorgias-chat-container, #gorgias-web-messenger-container,
    #intercom-container, .intercom-lightweight-app, .intercom-launcher-frame,
    #tidio-chat, .tidio-chat,
    #hubspot-messages-iframe-container, .hs-chat, .hs-messages-widget,
    #drift-widget, .drift-frame-controller,
    .zEWidget-launcher, #launcher,
    #fb-root .fb_dialog, .fb_dialog {
      display: none !important; visibility: hidden !important;
    }

    .print-only { display: block !important; }
  }

  /* PRINT Layout im Prestige Stil */
  .gift-card__print {
    font-family: var(--heading-font-family), system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    max-width: 540px; margin: 0 auto;
  }
  .gift-card__print .center { text-align: center; }
  .gift-card__print .logo { display: block; margin: 0 auto 16px auto; max-width: 200px; height: auto; }
  .gift-card__print .hero {
    width: 100%; height: auto; margin: 0 auto 24px; display: block; border-radius: 8px;
  }
  .gift-card__print .row { margin: 8px 0; }
  .gift-card__print .line { border-bottom: 0.5px solid #000; display: inline-block; width: 330px; margin-left: 6px; vertical-align: baseline; }
  .gift-card__print .code-box {
    text-align: center; border: 1px solid #000; padding: 10px 16px; border-radius: 8px;
    font-weight: 600; letter-spacing: 2px; font-size: 16px;
  }
  .gift-card__print .banner {
    background: #EFE7DE; color: #000; padding: 10px 14px; border-radius: 10px;
    text-align: center; margin: 12px 0 6px 0;
  }
  .gift-card__print .small { font-size: 12px; opacity: 0.8; }
  .gift-card__print .qr { margin-top: 10px; }
</style>

<div class="color-scheme color-scheme--{{ section.settings.content_color_scheme.id }}">
  <div class="section-split sm:min-h-fill">

    {%- comment -%} Linke Bildspalte - nur Screen {%- endcomment -%}
    <div class="section-split__column section-split__column--image section-split__column--flushed screen-only">
      <div class="content-box h-full min-h-xs color-scheme color-scheme--{{ section.settings.image_color_scheme.id }}">
        {%- if section.settings.background_image != blank -%}
          <div class="content-box__background-media">
            {{- section.settings.background_image | image_url: width: section.settings.background_image.width | image_tag: sizes: '(max-width: 699px) 100vw, 50vw', widths: '200,300,400,600,800,1000,1200,1400,1600,1800,2000' -}}
          </div>
        {%- endif -%}

        {%- if section.settings.show_scrolling_title -%}
          <div class="column-span-full align-self-center">
            <marquee-text
              speed="{{ section.settings.marquee_speed }}"
              direction="{{ section.settings.marquee_direction }}"
              class="scrolling-content">
              <div class="scrolling-content__item" style="font-size: var(--text-h1)">
                <h1 class="h1">
                  {%- if section.settings.marquee_text != blank -%}
                    {{ section.settings.marquee_text }}
                  {%- else -%}
                    {{ 'gift_card.general.title' | t }}
                  {%- endif -%}
                </h1>
              </div>
            </marquee-text>
          </div>
        {%- endif -%}
      </div>
    </div>

    {%- comment -%} Rechte Inhaltsspalte {%- endcomment -%}
    <div class="section-split__column align-self-stretch">
      <div class="gift-card">

        {%- comment -%} Screen Version {%- endcomment -%}
        <div class="gift-card__screen screen-only">
          <div class="v-stack gap-6">
            {%- if gift_card.expired or gift_card.enabled == false -%}
              {%- assign banner_error = 'gift_card.issued.expired' | t -%}
              {%- render 'banner', status: 'error', content: banner_error -%}
            {%- endif -%}

            <div class="v-stack gap-4">
              <p class="subheading">{{ 'gift_card.issued.remaining_amount' | t }}</p>

              {%- if settings.currency_code_enabled -%}
                {%- assign gift_card_balance = gift_card.balance | money_with_currency -%}
                {%- assign gift_card_initial_value = gift_card.initial_value | money_with_currency -%}
              {%- else -%}
                {%- assign gift_card_balance = gift_card.balance | money -%}
                {%- assign gift_card_initial_value = gift_card.initial_value | money -%}
              {%- endif -%}

              <p class="h1">{{ gift_card_balance }}</p>

              {%- if gift_card.balance != gift_card.initial_value -%}
                <p class="subheading">{{ 'gift_card.issued.out_of_html' | t: initial_value: gift_card_initial_value }}</p>
              {%- endif -%}
            </div>

            <p>{{ 'gift_card.issued.redeem_instructions' | t }}</p>

            <div class="v-stack gap-3">
              <input class="input gift-card__code" type="text" value="{{ gift_card.code | format_code }}" readonly aria-label="{{ 'gift_card.issued.code' | t }}" onclick="this.select()">

              <div class="gift-card__action-buttons">
                <copy-button class="contents" data-text="{{ gift_card.code | escape }}">
                  {%- assign button_content = 'gift_card.general.copy' | t -%}
                  {%- render 'button', content: button_content -%}
                </copy-button>

                <button type="button" class="button button--outline" style="--button-text-color: var(--button-background-primary)" onclick="window.print()">
                  <button-content class="button__content" rotated-text="{{ 'gift_card.general.print' | t | escape }}">
                    {{ 'gift_card.general.print' | t }}
                  </button-content>
                </button>
              </div>
            </div>

            {%- if gift_card.expires_on -%}
              {%- assign expires_on = gift_card.expires_on | date: format: 'date' -%}
              <p class="subheading">{{ 'gift_card.issued.expires_on' | t: expires_on: expires_on }}</p>
            {%- endif -%}
          </div>

          {%- if gift_card.pass_url or section.settings.show_qr_code -%}
            <div class="gift-card__pass-cards">
              {%- if section.settings.show_qr_code -%}
                <qr-code class="gift-card__qr-code" identifier="{{ gift_card.qr_identifier }}"></qr-code>
              {%- endif -%}

              {%- if gift_card.pass_url -%}
                <a class="gift-card__apple-wallet" href="{{ gift_card.pass_url }}">
                  <img src="{{ 'gift-card/add-to-apple-wallet.svg' | shopify_asset_url }}" width="145" height="45" alt="{{ 'gift_card.issued.add_to_apple_wallet' | t }}" loading="lazy">
                </a>
              {%- endif -%}
            </div>
          {%- endif -%}
        </div>

        {%- comment -%} Print Version {%- endcomment -%}
        <div id="gift-card-print" class="gift-card__print print-only">
          {%- if section.settings.image_logo != blank -%}
            {{ section.settings.image_logo | image_url: width: 400 | image_tag: class: 'logo', widths: '200,300,400' }}
          {%- endif -%}

          {%- assign print_image = section.settings.print_image | default: gift_card.product.featured_media -%}
          {%- if print_image != blank -%}
            {{ print_image | image_url: width: print_image.width | image_tag: class: 'hero', widths: '540,810,1080' }}
          {%- endif -%}

          <div class="center row">{{ section.settings.text_fuer }}:<span class="line"></span></div>
          <div class="center row">{{ section.settings.text_von }}:<span class="line"></span></div>

          <div class="center row">{{ 'gift_card.issued.redeem_instructions' | t }}</div>

          <div class="row">
            <div class="code-box">{{ gift_card.code | format_code }}</div>
          </div>

          {%- comment -%} Betrag/Restbetrag mit robustem Fallback {%- endcomment -%}
          {%- if settings.currency_code_enabled -%}
            {%- assign gift_card_balance = gift_card.balance | money_with_currency -%}
            {%- assign gift_card_initial_value = gift_card.initial_value | money_with_currency -%}
          {%- else -%}
            {%- assign gift_card_balance = gift_card.balance | money -%}
            {%- assign gift_card_initial_value = gift_card.initial_value | money -%}
          {%- endif -%}

          {%- if gift_card.expired or gift_card.enabled == false -%}
            <div class="banner">{{ 'gift_card.issued.expired' | t }}</div>
          {%- else -%}
            {%- if gift_card.balance == gift_card.initial_value -%}
              {%- capture t_amount -%}{{ 'gift_card.issued.amount' | t: initial_value: gift_card_initial_value }}{%- endcapture -%}
              {%- assign t_amount_lc = t_amount | downcase -%}
              <div class="banner">
                {%- if t_amount_lc contains 'translation missing' -%}
                  Betrag: {{ gift_card_initial_value }}
                {%- else -%}
                  {{ t_amount }}
                {%- endif -%}
              </div>
            {%- else -%}
              {%- capture t_remaining -%}{{ 'gift_card.issued.remaining_amount' | t }}{%- endcapture -%}
              {%- capture t_out_of -%}{{ 'gift_card.issued.out_of_html' | t: initial_value: gift_card_initial_value }}{%- endcapture -%}
              {%- assign t_remaining_lc = t_remaining | downcase -%}
              {%- assign t_out_of_lc = t_out_of | downcase -%}
              <div class="banner">
                {%- if t_remaining_lc contains 'translation missing' or t_out_of_lc contains 'translation missing' -%}
                  Restbetrag: {{ gift_card_balance }} von {{ gift_card_initial_value }}
                {%- else -%}
                  {{ t_remaining }} {{ gift_card_balance }} - {{ t_out_of }}
                {%- endif -%}
              </div>
            {%- endif -%}
          {%- endif -%}

          {%- if gift_card.expires_on -%}
            {%- assign expires_on = gift_card.expires_on | date: format: 'date' -%}
            <div class="center small row">{{ 'gift_card.issued.expires_on' | t: expires_on: expires_on }}</div>
          {%- endif -%}

          {%- if section.settings.show_qr_code -%}
            <div class="center qr">
              <qr-code class="gift-card__qr-code" identifier="{{ gift_card.qr_identifier }}"></qr-code>
            </div>
          {%- endif -%}
        </div>
        {%- comment -%} Ende Print {%- endcomment -%}
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "t:sections.main_gift_card.name",
  "class": "shopify-section--main-gift-card",
  "tag": "section",
  "settings": [
    {
      "type": "color_scheme",
      "id": "image_color_scheme",
      "label": "t:sections.main_gift_card.image_color_scheme",
      "default": "scheme-4"
    },
    {
      "type": "color_scheme",
      "id": "content_color_scheme",
      "label": "t:sections.main_gift_card.content_color_scheme",
      "default": "scheme-1"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "t:global.image.background_image",
      "info": "t:sections.main_gift_card.background_image_size_recommendation"
    },

    {
      "type": "checkbox",
      "id": "show_scrolling_title",
      "label": "Scrollenden Titel anzeigen",
      "default": true
    },
    {
      "type": "text",
      "id": "marquee_text",
      "label": "Scroll-Titel Inhalt",
      "default": "GIFT CARD"
    },
    {
      "type": "select",
      "id": "marquee_direction",
      "label": "Scroll-Richtung",
      "default": "start-to-end",
      "options": [
        { "value": "start-to-end", "label": "Links nach rechts" },
        { "value": "end-to-start",  "label": "Rechts nach links" }
      ]
    },
    {
      "type": "range",
      "id": "marquee_speed",
      "label": "Scroll-Geschwindigkeit",
      "min": 0.1,
      "max": 0.8,
      "step": 0.1,
      "default": 0.3
    },

    {
      "type": "checkbox",
      "id": "show_qr_code",
      "label": "t:sections.main_gift_card.show_qr_code",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "image_logo",
      "label": "Logo oben im Print",
      "info": "Wird nur beim Drucken angezeigt"
    },
    {
      "type": "image_picker",
      "id": "print_image",
      "label": "Gutscheinbild f체r Print",
      "info": "Wenn leer, wird das Produktbild genutzt"
    },
    {
      "type": "text",
      "id": "text_fuer",
      "label": "Beschriftung F체r",
      "default": "F체r"
    },
    {
      "type": "text",
      "id": "text_von",
      "label": "Beschriftung Von",
      "default": "Von"
    }
  ]
}
{% endschema %}
